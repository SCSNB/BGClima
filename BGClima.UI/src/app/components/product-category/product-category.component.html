<div class="category-container">
  <div class="category-header">
    <h1 class="category-title">{{ categoryTitle }}</h1>
    <button *ngIf="isMobile" mat-flat-button class="mobile-filter-btn" (click)="openFiltersDialog()">
      Филтри
    </button>
  </div>

  <!-- Mobile Filter Dialog -->
  <ng-template #mobileFiltersDialog>
    <app-filter-dialog 
      [isMobile]="true" 
      [title]="'Филтрирай по'"
      [showClearButton]="true"
      (apply)="applyFilters(currentFilters); closeFiltersDialog()"
      (clear)="clearFilters()"
      (close)="closeFiltersDialog()">
      <div class="filters-wrapper">
        <app-product-filters 
          [currentCategory]="currentCategory" 
          [minPrice]="minPrice" 
          [maxPrice]="maxPrice" 
          (filtersChanged)="onFiltersChanged($event)">
        </app-product-filters>
      </div>
    </app-filter-dialog>
  </ng-template>
  <div class="content-wrapper">
    <aside class="filters-sidebar" *ngIf="!isMobile">
      <app-product-filters [currentCategory]="currentCategory" [minPrice]="minPrice" [maxPrice]="maxPrice" (filtersChanged)="applyFilters($event)"></app-product-filters>
    </aside>
    <div class="product-grid">
      <ng-container *ngIf="filteredProducts.length > 0; else noProducts">
        <a *ngFor="let product of filteredProducts" [routerLink]="['/product', product.id]" class="offer-card-link">
          <div class="offer-card">
            <div class="offer-card-image-badges">
              <img [src]="product.imageUrl || 'assets/placeholder.png'" [alt]="product.name" class="offer-card-image" />
              <div class="offer-badges">
                <span class="badge" *ngFor="let b of product.badges" [ngStyle]="{background: b.bg, color: b.color}">{{ b.text }}</span>
              </div>
            </div>
            <div class="offer-card-title">{{ product.name }}</div>
            <div class="offer-card-prices">
              <div class="price-container">
                <div class="current-prices">
                  <span class="current-price">{{ product.price | number:'1.2-2' }} лв.</span>
                  <span class="current-price-eur">/ {{ product.priceEur | number:'1.2-2' }} €</span>
                </div>
                <div class="old-prices" *ngIf="product.oldPrice">
                  <span class="old-price">{{ product.oldPrice | number:'1.2-2' }} лв.</span>
                  <span class="old-price-eur" *ngIf="product.oldPriceEur">/ {{ product.oldPriceEur | number:'1.2-2' }} €</span>
                </div>
              </div>
            </div>
            <div class="offer-card-brand-row">
              <span class="brand-text">{{ product.brand?.name }}</span>
              <button class="compare-btn" type="button">Сравни</button>
            </div>
            <div class="offer-card-specs">
              <ng-container *ngFor="let spec of product.specs">
                <div class="spec" *ngIf="spec?.value">
                  <div class="spec-icon" [ngClass]="spec.icon">
                    <span class="material-icons">{{ spec.icon }}</span>
                  </div>
                  <div class="spec-details">
                    <div class="spec-label">{{ spec.label }}</div>
                    <div class="spec-value">{{ spec.value }}</div>
                  </div>
                </div>
              </ng-container>
            </div>
          </div>
        </a>
      </ng-container>
      <ng-template #noProducts>
        <p>Няма намерени продукти в тази категория.</p>
      </ng-template>
    </div>
  </div>
</div>

<!-- Mobile Filters Dialog duplicate removed -->
