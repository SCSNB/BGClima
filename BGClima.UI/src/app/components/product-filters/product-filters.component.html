<mat-accordion multi>

  <!-- Categories quick navigation (dynamic: Климатици / Термопомпи) -->
  <mat-expansion-panel *ngIf="showCategoriesNav" [expanded]="true">
    <mat-expansion-panel-header>
      <mat-panel-title>
        {{ sectionTitle }}
      </mat-panel-title>
    </mat-expansion-panel-header>
    <nav class="categories-nav">
      <a *ngFor="let c of categoriesToShow" [routerLink]="['/products', c.slug]" routerLinkActive="active" class="category-link">
        {{ c.label }}
      </a>
    </nav>
  </mat-expansion-panel>

  <mat-divider *ngIf="showCategoriesNav"></mat-divider>

  <!-- Brand Filter -->
  <mat-expansion-panel [expanded]="true">
    <mat-expansion-panel-header>
      <mat-panel-title>
        Марка
      </mat-panel-title>
    </mat-expansion-panel-header>
    <div class="filter-options">
      <mat-checkbox *ngFor="let b of brands"
                    [checked]="isSelected(filters.brands, b.name)"
                    (change)="toggleFilter(filters.brands, b.name)">
        {{ b.name }}
      </mat-checkbox>
    </div>
  </mat-expansion-panel>

  <mat-divider></mat-divider>

  <!-- Price Filter -->
  <mat-expansion-panel [expanded]="true">
    <mat-expansion-panel-header>
      <mat-panel-title>
        Цена
      </mat-panel-title>
    </mat-expansion-panel-header>
    <div class="price-filter">
      <div class="bars-wrap">
        <!-- Базови сиви ивички по цялата ширина -->
        <div class="base-bars" aria-hidden="true"></div>
        <!-- Цветни ивички само между От–До -->
        <div class="selected-bars" aria-hidden="true"
             [style.left.%]="lowerPct" [style.width.%]="selectedWidthPct">
          <div class="selected-bars-stripes"></div>
        </div>
        <div class="slider-overlay">
          <mat-slider [min]="minPrice" [max]="maxPrice" [step]="1">
            <input matSliderStartThumb type="range"
                   [(ngModel)]="filters.price.lower" name="priceLowerThumb"
                   (ngModelChange)="onFiltersChanged()">
            <input matSliderEndThumb type="range"
                   [(ngModel)]="filters.price.upper" name="priceUpperThumb"
                   (ngModelChange)="onFiltersChanged()">
          </mat-slider>
        </div>
      </div>
      <div class="price-range-display">
        <span class="value">{{ filters.price.lower | number:'1.0-0' }} – <strong>{{ filters.price.upper | number:'1.0-0' }}</strong> <small>лв.</small></span>
      </div>
    </div>
  </mat-expansion-panel>

  <mat-divider></mat-divider>

  <!-- Energy Class Filter -->
  <mat-expansion-panel [expanded]="true" *ngIf="!isToploobmennici">
    <mat-expansion-panel-header>
      <mat-panel-title>
        Енергиен клас
      </mat-panel-title>
    </mat-expansion-panel-header>
    <div class="filter-options">
      <mat-checkbox [checked]="isSelected(filters.energyClasses, 'A+++')" (change)="toggleFilter(filters.energyClasses, 'A+++')">A+++</mat-checkbox>
      <mat-checkbox [checked]="isSelected(filters.energyClasses, 'A++')" (change)="toggleFilter(filters.energyClasses, 'A++')">A++</mat-checkbox>
      <mat-checkbox [checked]="isSelected(filters.energyClasses, 'A+')" (change)="toggleFilter(filters.energyClasses, 'A+')">A+</mat-checkbox>
      <mat-checkbox [checked]="isSelected(filters.energyClasses, 'A')" (change)="toggleFilter(filters.energyClasses, 'A')">A</mat-checkbox>
    </div>
  </mat-expansion-panel>

  <mat-divider></mat-divider>

  <!-- Power (kW) for Heat Pump categories -->
  <mat-expansion-panel *ngIf="isHeatPumpSection && !isToploobmennici" [expanded]="true">
    <mat-expansion-panel-header>
      <mat-panel-title>
        Мощност (kW)
      </mat-panel-title>
    </mat-expansion-panel-header>
    <div class="filter-options">
      <mat-checkbox *ngFor="let kw of powerKwOptions"
                    [checked]="isSelected(filters.powerKws, kw)"
                    (change)="toggleFilter(filters.powerKws, kw)">
        {{ kw }}
      </mat-checkbox>
    </div>
  </mat-expansion-panel>

  <!-- BTU Filter -->
  <!-- Показваме за всички НЕ-термопомпени + специално за bgclima-toploobmennici -->
  <mat-expansion-panel *ngIf="!isHeatPumpSection || isToploobmennici" [expanded]="true">
    <mat-expansion-panel-header>
      <mat-panel-title>
        BTU
      </mat-panel-title>
    </mat-expansion-panel-header>
    <div class="filter-options">
      <mat-checkbox *ngFor="let btu of btuOptionsToShow"
                    [checked]="isSelected(filters.btus, btu.value)"
                    (change)="toggleFilter(filters.btus, btu.value)">
        {{ formatBtuLabel(btu) }}
      </mat-checkbox>
    </div>
  </mat-expansion-panel>

  <mat-divider></mat-divider>

  <!-- Room Size Filter (non-heat-pump only) -->
  <mat-expansion-panel *ngIf="!isHeatPumpSection" [expanded]="true">
    <mat-expansion-panel-header>
      <mat-panel-title>
        За помещения (кв.м)
      </mat-panel-title>
    </mat-expansion-panel-header>
    <div class="filter-options">
      <mat-checkbox *ngFor="let size of roomSizeOptions"
                   [checked]="isSelected(filters.roomSizeRanges, size.value)"
                   (change)="toggleFilter(filters.roomSizeRanges, size.value)">
        {{ size.label }}
      </mat-checkbox>
    </div>
  </mat-expansion-panel>
</mat-accordion>
