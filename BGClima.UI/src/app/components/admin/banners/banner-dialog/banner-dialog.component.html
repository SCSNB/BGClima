<h2 mat-dialog-title>{{ isEditMode ? 'Редактиране на банер' : 'Добавяне на нов банер' }}</h2>

<mat-dialog-content>
  <form [formGroup]="bannerForm" (ngSubmit)="onSubmit()">
    <div class="form-container">
     
      <!-- Form Fields -->
      <div class="form-fields">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Име на банер</mat-label>
          <input matInput formControlName="name" placeholder="Въведете име на банер" required>
          <mat-error *ngIf="bannerForm.get('name')?.hasError('required')">Името е задължително</mat-error>
          <mat-error *ngIf="bannerForm.get('name')?.hasError('maxlength')">Името трябва да бъде до 100 символа</mat-error>
        </mat-form-field>

        <!-- Image Upload -->
        <div class="image-upload-container full-width">
          <div *ngIf="imagePreview" class="image-preview" [class.has-image]="imagePreview">
            <img [src]="imagePreview" alt="Preview" class="preview-image">
          </div>
          <input type="file" accept="image/*" (change)="onFileSelected($event)" style="display: none" #fileInput>
          <button type="button" mat-stroked-button color="primary" (click)="fileInput.click()" class="upload-button">
            <mat-icon>cloud_upload</mat-icon> Изберете снимка
          </button>
          <mat-hint>Поддържани формати: JPG, PNG, GIF. Максимален размер: 5MB</mat-hint>
          <mat-error *ngIf="bannerForm.get('imageUrl')?.hasError('required')">Изображението е задължително</mat-error>
        </div>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Целеви URL</mat-label>
          <input matInput formControlName="targetUrl" placeholder="https://example.com">
          <mat-hint>URL, към който да сочи банерът</mat-hint>
          <mat-error *ngIf="bannerForm.get('targetUrl')?.hasError('maxlength')">URL адресът трябва да бъде до 1000 символа</mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Пореден номер </mat-label>
          <input matInput type="number" formControlName="displayOrder" min="0">
          <mat-hint>По-малки числа са по-напред</mat-hint>
          <mat-error *ngIf="bannerForm.get('displayOrder')?.hasError('required')">Полето е задължително</mat-error>
          <mat-error *ngIf="bannerForm.get('displayOrder')?.hasError('min')">Стойността трябва да бъде по-голяма или равна на 0</mat-error>
          <mat-error *ngIf="bannerForm.get('displayOrder')?.hasError('pattern')">Моля, въведете валидно число</mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Тип на банер</mat-label>
          <mat-select formControlName="type">
            <mat-option *ngFor="let type of bannerTypes" [value]="type.value">
              {{ type.viewValue }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-checkbox formControlName="isActive" color="primary">Активен</mat-checkbox>
      </div>
    </div>
  </form>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="onCancel()">Отказ</button>
  <button 
    mat-raised-button 
    color="primary" 
    (click)="onSubmit()" 
    [disabled]="bannerForm.invalid || isSubmitting"
    [class.spinner]="isSubmitting"
  >
    <span *ngIf="!isSubmitting">{{ isEditMode ? 'Запази' : 'Създай' }}</span>
    <mat-spinner *ngIf="isSubmitting" diameter="24"></mat-spinner>
  </button>
</mat-dialog-actions>
